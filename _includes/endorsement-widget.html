<!-- Endorsement Widget -->
{% assign prop_id = page.url | replace: '/proposal/', '' | replace: '/', ''  %}
<div class="endorsement-widget">
  <h3>Community Endorsements</h3>
  <div id="widget-stats-{{ prop_id }}">
    <p>Loading endorsement count...</p>
  </div>
  <p>
    <a href="{{ '/endorsement/' | relative_url }}?proposal={{ prop_id }}" class="btn btn-primary">
      Endorse this Proposal
    </a>
  </p>
</div>

<script>
(function() {
  const proposalId = '{{ prop_id }}';
  const workerUrl = 'https://orcid-endorsement-worker-production.excitations-org.workers.dev';
  
  fetch(`${workerUrl}/api/stats?proposal_id=${proposalId}`)
    .then(response => response.json())
    .then(data => {
      const statsDiv = document.getElementById('widget-stats-' + proposalId);
      if (statsDiv && data.total !== undefined) {
        statsDiv.innerHTML = `
          <p class="endorsement-count">${data.total}</p>
	  <p>researcher${data.total !== 1 ? 's' : ''} ${data.total !== 1 ? 'have' : 'has'} endorsed this proposal</p>
        `;
      }
    })
    .catch(error => {
      console.error('Failed to load endorsement count:', error);
    });
})();
</script>
